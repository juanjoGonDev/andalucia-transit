<section class="home">
  <div class="home__content">
    <header class="home__header">
      <h1 class="home__title">{{ headerTitleKey | translate }}</h1>
      <button
        type="button"
        class="home__info-button"
        [attr.aria-label]="headerInfoLabelKey | translate"
      >
        <span class="material-symbols-outlined">{{ infoIcon }}</span>
      </button>
    </header>
    <main class="home__main">
      <app-section [titleKey]="searchTitleKey" appearance="card">
        @defer (on viewport) {
          <app-route-search-form
            [initialSelection]="currentSelection$ | async"
            (selectionConfirmed)="onSelectionConfirmed($event)"
          ></app-route-search-form>
        } @placeholder {
          <div class="home-search-placeholder" aria-hidden="true">
            <span class="home-search-placeholder__field"></span>
            <span class="home-search-placeholder__field"></span>
            <span class="home-search-placeholder__field"></span>
            <span class="home-search-placeholder__action"></span>
          </div>
        }
      </app-section>
      <app-section
        [titleKey]="recentStopsTitleKey"
        [actionsTemplate]="recentStopsActions"
      >
        <ng-template #recentStopsActions>
          <button
            type="button"
            class="home__section-action"
            *ngIf="recentClearActionVisible()"
            (click)="onClearRecentSearches()"
          >
            {{ recentStopsClearKey | translate }}
          </button>
        </ng-template>
        @defer (on viewport) {
          <app-home-recent-searches
            #recentSearches
            (itemsStateChange)="onRecentItemsStateChange($event)"
          ></app-home-recent-searches>
        } @placeholder {
          <ul class="home-recent-placeholder" aria-hidden="true">
            <li
              *ngFor="let index of recentPlaceholderItems"
              class="home-recent-placeholder__item"
            >
              <span class="home-recent-placeholder__line home-recent-placeholder__line--primary"></span>
              <span class="home-recent-placeholder__line home-recent-placeholder__line--secondary"></span>
            </li>
          </ul>
        }
      </app-section>
      <app-section [titleKey]="findNearbyTitleKey">
        <app-card-list-item
          [leadingIcon]="locationAction.leadingIcon"
          [titleKey]="locationAction.titleKey"
          [layout]="locationActionLayout"
          [iconVariant]="locationActionIconVariant"
          [trailingIcon]="trailingIcon"
          [ariaLabelKey]="locationAction.ariaLabelKey"
          (action)="openNearbyStopsDialog()"
        ></app-card-list-item>
      </app-section>
      <app-section [titleKey]="favoritesTitleKey">
        <div class="home__favorites">
          <p class="home__favorites-description">{{ favoritesDescriptionKey | translate }}</p>
          <ng-container *ngIf="hasFavorites(); else favoritesEmpty">
            <ul class="home__favorites-list" role="list">
              <li
                class="home__favorites-item"
                *ngFor="let favorite of favoritePreview(); trackBy: trackFavorite"
              >
                <button
                  type="button"
                  class="home__favorites-button"
                  (click)="openFavorite(favorite)"
                >
                  <span class="material-symbols-outlined home__favorites-icon">{{ favoriteIcon() }}</span>
                  <span class="home__favorites-text">
                    <span class="home__favorites-name">{{ favorite.name }}</span>
                    <span class="home__favorites-meta">
                      {{ favoritesCodeLabelKey | translate }}: {{ favorite.code }} Â· {{ favorite.municipality }}
                    </span>
                  </span>
                </button>
              </li>
            </ul>
          </ng-container>
          <ng-template #favoritesEmpty>
            <p class="home__favorites-empty">{{ favoritesEmptyKey | translate }}</p>
          </ng-template>
          <app-card-list-item
            [leadingIcon]="favoriteIcon()"
            [titleKey]="favoritesActionKey"
            [layout]="locationActionLayout"
            [iconVariant]="locationActionIconVariant"
            [trailingIcon]="trailingIcon"
            [commands]="favoritesCommands"
          ></app-card-list-item>
        </div>
      </app-section>
    </main>
  </div>
</section>
